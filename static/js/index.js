// Generated by CoffeeScript 2.7.0
(function() {
  var Hs, root;

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  // !!!! Hotpoor root object
  root.Hs || (root.Hs = {});

  Hs = root.Hs;

  console.log("hello, xialiwei");

  Hs.xialiwei_waterfall_layout_items_data_authors = {
    "user_newconceptenglish_1": {
      "name": "Êñ∞Ê¶ÇÂøµËã±ËØ≠Á¨¨‰∏ÄÂÜå",
      "thumbnail": "http://cdn0.ofcourse.io/02f1cf87528d43a0a676491c06cf1789_dfb24bd9ffa57be147d5757102138cc1?imageView2"
    },
    "user0": {
      "name": "Âïä‰∏Ä‰∏ò",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/1040g2jo312117b9aj40g4a4hdcrcnqq4ps1bct0?imageView2/2/w/60/format/webp|imageMogr2/strip"
    },
    "user1": {
      "name": "TAYLOR.Ê¥õüí§",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/1040g2jo311q27pt7n2005p046lujq6249rp8pb8?imageView2/2/w/60/format/webp|imageMogr2/strip"
    },
    "user2": {
      "name": "Â¶ûÂ∞èÁâõüêÆ",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/630fa11b185ca4c669595608.jpg?imageView2/2/w/60/format/webp|imageMogr2/strip"
    },
    "user3": {
      "name": "ÂÆãÈõ®Áê¶_G-I-DLE",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/61dbf1ed59012e6c5b32879b.jpg?imageView2/2/w/60/format/webp|imageMogr2/strip"
    },
    "user4": {
      "name": "Â∏É‰∏ÅÊ¶¥Ëé≤ÈÖ±",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/58ac478c5e87e766851104c7.jpg?imageView2/2/w/60/format/webp|imageMogr2/strip"
    },
    "user5": {
      "name": "Demon Elves",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/63d9f786c22fa7bf98e9eed7.jpg?imageView2/2/w/60/format/webp|imageMogr2/strip"
    },
    "user6": {
      "name": "ÈáëÈáëÁåõÁÅ´Âé®Êàø",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/6033ad79816ab524fa53f274.jpg?imageView2/2/w/60/format/webp|imageMogr2/strip"
    },
    "user7": {
      "name": "ÊùëÂ§¥ÂØåÂ©Ü",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/60878dd138950d4308e54061.jpg?imageView2/2/w/60/format/webp|imageMogr2/strip"
    },
    "user8": {
      "name": "ÁéõÊ£ÆÂπ≥‰ª∑Â§çÂè§Â∞èÂ∫ó",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/609e89fee733be8eb0b3bb05.jpg?imageView2/2/w/60/format/webp|imageMogr2/strip"
    },
    "user9": {
      "name": "Âº†‰ø™",
      "thumbnail": "https://sns-avatar-qc.xhscdn.com/avatar/1040g2jo312117b9aj40g4a4hdcrcnqq4ps1bct0?imageView2/2/w/60/format/webp|imageMogr2/strip"
    }
  };

  Hs.xialiwei_waterfall_layout_items_data_flag = {
    "current_all_y": []
  };

  Hs.xialiwei_waterfall_layout_items_data = [
    {
      "thumbnail": "http://cdn0.ofcourse.io/02f1cf87528d43a0a676491c06cf1789_9d3e960f16ef8e6aea683533b37f1962?imageView2",
      "width": 2479,
      "height": 3508,
      "ui_type": "xhs_note",
      "type": "note",
      "creator_type": "author",
      "author": "user_newconceptenglish_1",
      "title": "Lesson 1 Excuse me! ÂØπ‰∏çËµ∑",
      "likes_num": 5885
    },
    {
      "thumbnail": "http://cdn0.ofcourse.io/02f1cf87528d43a0a676491c06cf1789_9d3e960f16ef8e6aea683533b37f1962?imageView2",
      "gallery": ["http://cdn0.ofcourse.io/02f1cf87528d43a0a676491c06cf1789_9d3e960f16ef8e6aea683533b37f1962?imageView2",
    "http://cdn0.ofcourse.io/02f1cf87528d43a0a676491c06cf1789_963ce28af9498e1327285e09e77ab9c9?imageView2"],
      "width": 2479,
      "height": 3508,
      "ui_type": "xhs_note",
      "type": "note",
      "creator_type": "author",
      "author": "user_newconceptenglish_1",
      "title": "Lesson 1 Excuse me! ÂØπ‰∏çËµ∑",
      "likes_num": 5885
    },
    {
      "thumbnail": "http://cdn0.ofcourse.io/02f1cf87528d43a0a676491c06cf1789_9d3e960f16ef8e6aea683533b37f1962?imageView2",
      "gallery": ["http://cdn0.ofcourse.io/02f1cf87528d43a0a676491c06cf1789_9d3e960f16ef8e6aea683533b37f1962?imageView2",
    "http://cdn0.ofcourse.io/02f1cf87528d43a0a676491c06cf1789_963ce28af9498e1327285e09e77ab9c9?imageView2"],
      "audio": "http://cdn0.ofcourse.io/02f1cf87528d43a0a676491c06cf1789_f_fc5acfe8cb2c2b22447a7bfd6651f000",
      "width": 2479,
      "height": 3508,
      "ui_type": "xhs_note_audio",
      "type": "note",
      "creator_type": "author",
      "author": "user_newconceptenglish_1",
      "title": "Lesson 1 Excuse me! ÂØπ‰∏çËµ∑",
      "likes_num": 5885
    }
  ];

  Hs.base_demo_data = [
    {
      "thumbnail": "static/img/0.webp",
      "width": 500,
      "height": 500,
      "ui_type": "xhs_note",
      "type": "note",
      "creator_type": "author",
      "author": "user0",
      "title": "XXXÂÖ¨Âè∏XXXÂü∫Âú∞XXXÂå∫XXXÁÇπ",
      "likes_num": 5885
    },
    {
      "thumbnail": "static/img/1.webp",
      "width": 1080,
      "height": 1920,
      "ui_type": "xhs_note",
      "type": "note",
      "creator_type": "authors",
      "authors": ["user0",
    "user1"],
      "title": "XXXÂÖ¨Âè∏XXXÂü∫Âú∞XXXÂå∫XXXÁÇπ",
      "likes_num": 0
    },
    {
      "thumbnail": "static/img/2.webp",
      "width": 1920,
      "height": 1080,
      "ui_type": "xhs_note",
      "type": "note",
      "creator_type": "author",
      "author": "user7",
      "title": "XXXÂÖ¨Âè∏XXXÂü∫Âú∞XXXÂå∫XXXÁÇπ",
      "likes_num": 555
    },
    {
      "thumbnail": "static/img/3.webp",
      "width": 800,
      "height": 600,
      "ui_type": "xhs_note",
      "type": "note",
      "creator_type": "authors",
      "authors": ["user1",
    "user0"],
      "title": "",
      "likes_num": 112
    },
    {
      "thumbnail": "static/img/4.webp",
      "width": 500,
      "height": 500,
      "ui_type": "xhs_note",
      "type": "note",
      "creator_type": "author",
      "author": "user6",
      "title": "XXXÂÖ¨Âè∏XXXÂü∫Âú∞XXXÂå∫XXXÁÇπ",
      "likes_num": 5885
    },
    {
      "thumbnail": "static/img/5.webp",
      "width": 1080,
      "height": 1920,
      "ui_type": "xhs_note",
      "type": "note",
      "creator_type": "authors",
      "authors": ["user0",
    "user1"],
      "title": "XXXÂÖ¨Âè∏XXXÂü∫Âú∞XXXÂå∫XXXÁÇπ",
      "likes_num": 0
    }
  ];

  Hs.xialiwei_waterfall_layout_items_load = function(cards_dom, cards_width = 500, cards_height = 500, column = 2, item_data_index = 0) {
    var _html, _html_creator, _html_creator_author, _html_creator_author_name, _html_creator_author_thumbnail, _html_gap, _html_height, _html_title, _html_uuid, _html_width, _html_width_base, _img_html_all, _xhs_note_thumbnail_more, _xhs_note_thumbnail_num, _xhs_note_thumbnail_span, current_all_y, h, i, img, item_data, items_all_num, items_num_need, j, k, l, len, len1, ref, ref1, ref2, ref3, ref4, use_max, use_max_index, use_min, use_min_index, w, x, y;
    console.log("xialiwei_waterfall_layout_items_load");
    $(cards_dom).css({
      width: cards_width,
      height: cards_height
    });
    _html_gap = 10;
    _html_width_base = (cards_width - _html_gap * (column - 1)) / column;
    current_all_y = [];
    for (i = j = 0, ref = column - 1; (0 <= ref ? j <= ref : j >= ref); i = 0 <= ref ? ++j : --j) {
      current_all_y.push(0);
    }
    Hs.xialiwei_waterfall_layout_items_data_flag["current_all_y"] = current_all_y;
    items_all_num = Hs.xialiwei_waterfall_layout_items_data.length;
    items_num_need = -1 * items_all_num;
    item_data_index = 0;
    ref1 = Hs.xialiwei_waterfall_layout_items_data.slice(items_num_need);
    // if current_all_y.length != Hs.xialiwei_waterfall_layout_items_data_flag["current_all_y"].length
    //     Hs.xialiwei_waterfall_layout_items_data_flag["current_all_y"]=current_all_y
    //     item_data_index = 0
    // else
    //     current_all_y=Hs.xialiwei_waterfall_layout_items_data_flag["current_all_y"]
    // console.log "data:",cards_width,_html_gap,column,_html_width_base
    // item_data_index = item_data_index
    // items_all_num = Hs.xialiwei_waterfall_layout_items_data.length
    // items_num_need = (items_all_num-item_data_index)*(-1)
    for (k = 0, len = ref1.length; k < len; k++) {
      item_data = ref1[k];
      if ((ref2 = item_data["ui_type"]) === "xhs_note") {
        _html_title = "";
        _html_creator = "";
        if (item_data["title"] != null) {
          if (item_data["title"].length > 0) {
            _html_title = `<div class="xhs_note_title">${item_data["title"]}</div>`;
          }
        }
        if ((ref3 = item_data["creator_type"]) === "author") {
          _html_creator_author = item_data["author"];
          _html_creator_author_name = Hs.xialiwei_waterfall_layout_items_data_authors[_html_creator_author]["name"];
          _html_creator_author_thumbnail = Hs.xialiwei_waterfall_layout_items_data_authors[_html_creator_author]["thumbnail"];
          _html_creator = `<div class="xhs_note_creator">
    <div class="xhs_note_creator_author_thumbnail">
        <div>
            <img src="${_html_creator_author_thumbnail}">
        </div>
    </div>
    <div class="xhs_note_creator_author_name">${_html_creator_author_name}</div>
</div>`;
        }
        _html_gap = 10;
        _html_width = (cards_width - _html_gap * (column - 1)) / column;
        _html_height = _html_width / item_data["width"] * item_data["height"];
        _html_uuid = Hs.uuid2(6, null);
        _img_html_all = `<img src="${item_data["thumbnail"]}">`;
        _xhs_note_thumbnail_num = 1;
        _xhs_note_thumbnail_more = false;
        _xhs_note_thumbnail_span = "";
        if (item_data["gallery"] != null) {
          _xhs_note_thumbnail_num = item_data["gallery"].length;
          _img_html_all = "";
          ref4 = item_data["gallery"];
          for (l = 0, len1 = ref4.length; l < len1; l++) {
            img = ref4[l];
            _img_html_all = `${_img_html_all}
<img src="${img}">`;
          }
          if (_xhs_note_thumbnail_num > 1) {
            _xhs_note_thumbnail_more = true;
            _xhs_note_thumbnail_span = `<span class="xhs_note_thumbnail_span xhs_note_thumbnail_span_gallery">
    <svg class="reds-icon" width="11" height="11"><use xlink:href="#gallery"></use></svg>
</span>`;
          }
        }
        _html = `<div class="xialiwei_waterfall_layout_item_card"
    data-ui-type="xhs_note"
    data-uuid="${_html_uuid}"
    style="
        width:${_html_width}px;
    "
    >
    <div class="xhs_note_thumbnail"
        data-thumbnail-num="${_xhs_note_thumbnail_num}"
        data-thumbnail-more="${_xhs_note_thumbnail_more}"
        data-thumbnail-num-current="0"
        style="
            width:${_html_width}px;
            height:${_html_height}px;
        ">
        <div class="xhs_note_thumbnail_imgs">
            ${_img_html_all}
            <div class="xhs_note_thumbnail_imgs_cover"></div>
        </div>
        ${_xhs_note_thumbnail_span}
    </div>
    ${_html_title}
    <div class="xhs_note_footer">
        ${_html_creator}
        <div class="xhs_note_likes">
        ${item_data["likes_num"]}
        </div>
    </div>
</div>`;
      } else {
        _html = "";
      }
      $(".xialiwei_waterfall_layout_item_cards_page").append(_html);
      console.log("w,h", $(`[data-uuid=${_html_uuid}]`).width(), $(`[data-uuid=${_html_uuid}]`).height());
      w = $(`[data-uuid=${_html_uuid}]`).width();
      h = $(`[data-uuid=${_html_uuid}]`).height();
      item_data["w"] = w;
      item_data["h"] = h;
      item_data["index"] = item_data_index;
      [use_min_index, use_min] = Hs.find_list_min_index_and_min(Hs.xialiwei_waterfall_layout_items_data_flag["current_all_y"]);
      console.log("use_min_index,use_min:", use_min_index, use_min);
      x = (use_min_index % column) * (_html_width + _html_gap);
      y = use_min;
      Hs.xialiwei_waterfall_layout_items_data_flag["current_all_y"][use_min_index] = y + h;
      [use_max_index, use_max] = Hs.find_list_max_index_and_max(Hs.xialiwei_waterfall_layout_items_data_flag["current_all_y"]);
      $(".xialiwei_waterfall_layout_item_cards_page").css({
        "width": "100%",
        "height": `${use_max}px`
      });
      $(`[data-uuid=${_html_uuid}]`).css({
        "transform": `translate(${x}px, ${y}px)`
      });
      item_data["x"] = x;
      item_data["y"] = y;
      item_data_index += 1;
      console.log(Hs.xialiwei_waterfall_layout_items_data_flag["current_all_y"]);
    }
    return console.log(Hs.xialiwei_waterfall_layout_items_data);
  };

  $(function() {
    var is_scroll_load_xialiwei_waterfall_layout_item_cards, is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first, is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first_scrollTop, is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second, is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second_scrollTop;
    $(window).on("load", function(evt) {
      var cards_dom, column_num, window_height, window_width;
      Hs.preload_svg();
      $(".xialiwei_waterfall_layout_item_cards_page").empty();
      cards_dom = $(".xialiwei_waterfall_layout_item_cards")[0];
      window_width = $(window).width() - 20;
      if (window_width < 320) {
        window_width = 320;
      }
      window_height = $(window).height() - 20;
      column_num = parseInt(window_width / 236);
      if (column_num < 3) {
        column_num = 2;
      }
      return Hs.xialiwei_waterfall_layout_items_load(cards_dom, window_width, window_height, column_num);
    });
    $(window).on("resize", function(evt) {
      var cards_dom, column_num, window_height, window_width;
      $(".xialiwei_waterfall_layout_item_cards_page").empty();
      cards_dom = $(".xialiwei_waterfall_layout_item_cards")[0];
      window_width = $(window).width() - 20;
      if (window_width < 320) {
        window_width = 320;
      }
      window_height = $(window).height() - 20;
      column_num = parseInt(window_width / 236);
      if (column_num < 3) {
        column_num = 2;
      }
      return Hs.xialiwei_waterfall_layout_items_load(cards_dom, window_width, window_height, column_num);
    });
    is_scroll_load_xialiwei_waterfall_layout_item_cards = false;
    is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first = false;
    is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first_scrollTop = 0;
    is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second = false;
    is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second_scrollTop = 0;
    $(".xialiwei_waterfall_layout_item_cards").on("scroll", function(evt) {
      var base_scroll_top, cards_dom, column_num, current_data_index, is_scroll_down, item_data, j, len, ref, window_height, window_width;
      console.log("scroll", evt);
      if (is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first) {
        if (!is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second) {
          is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second = true;
          is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second_scrollTop = $(".xialiwei_waterfall_layout_item_cards").scrollTop();
        }
      }
      if (!is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first) {
        is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first = true;
        is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first_scrollTop = $(".xialiwei_waterfall_layout_item_cards").scrollTop();
      }
      base_scroll_top = $(".xialiwei_waterfall_layout_item_cards").scrollTop();
      if (!is_scroll_load_xialiwei_waterfall_layout_item_cards && is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second) {
        is_scroll_down = is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second_scrollTop - is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first_scrollTop;
        console.log("is_scroll_first:", is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first_scrollTop);
        console.log("is_scroll_second:", is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second_scrollTop);
        console.log("is_scroll_down:", is_scroll_down);
        if (is_scroll_down <= 0) {
          is_scroll_load_xialiwei_waterfall_layout_item_cards = false;
          is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first = false;
          is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second = false;
          is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first_scrollTop = 0;
          is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second_scrollTop = 0;
          return;
        }
        is_scroll_load_xialiwei_waterfall_layout_item_cards = true;
        current_data_index = Hs.xialiwei_waterfall_layout_items_data.length + 1;
        ref = Hs.base_demo_data;
        for (j = 0, len = ref.length; j < len; j++) {
          item_data = ref[j];
          Hs.xialiwei_waterfall_layout_items_data.push(item_data);
        }
        $(".xialiwei_waterfall_layout_item_cards_page").empty();
        cards_dom = $(".xialiwei_waterfall_layout_item_cards")[0];
        window_width = $(window).width() - 20;
        if (window_width < 320) {
          window_width = 320;
        }
        window_height = $(window).height() - 20;
        column_num = parseInt(window_width / 236);
        if (column_num < 3) {
          column_num = 2;
        }
        Hs.xialiwei_waterfall_layout_items_load(cards_dom, window_width, window_height, column_num, current_data_index);
        $(".xialiwei_waterfall_layout_item_cards").scrollTop(base_scroll_top);
        return setTimeout(function() {
          is_scroll_load_xialiwei_waterfall_layout_item_cards = false;
          is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first = false;
          is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second = false;
          is_scroll_load_xialiwei_waterfall_layout_item_cards_has_first_scrollTop = 0;
          return is_scroll_load_xialiwei_waterfall_layout_item_cards_has_second_scrollTop = 0;
        }, 1000);
      }
    });
    return $("body").on("click", ".xhs_note_thumbnail[data-thumbnail-more=true] .xhs_note_thumbnail_span_gallery", function(evt) {
      var current_xhs_note_thumbnail, current_xhs_note_thumbnail_num, current_xhs_note_thumbnail_num_current, current_xhs_note_thumbnail_num_current_next, current_xhs_note_thumbnail_scrollLeft_each, current_xhs_note_thumbnail_scrollLeft_now, current_xhs_note_thumbnail_scrollWidth;
      current_xhs_note_thumbnail = $(this).parents(".xhs_note_thumbnail[data-thumbnail-more=true]")[0];
      current_xhs_note_thumbnail_scrollWidth = current_xhs_note_thumbnail.scrollWidth;
      current_xhs_note_thumbnail_num = $(current_xhs_note_thumbnail).attr("data-thumbnail-num");
      current_xhs_note_thumbnail_num = parseInt(current_xhs_note_thumbnail_num);
      current_xhs_note_thumbnail_num_current = $(current_xhs_note_thumbnail).attr("data-thumbnail-num-current");
      current_xhs_note_thumbnail_num_current = parseInt(current_xhs_note_thumbnail_num_current);
      current_xhs_note_thumbnail_scrollLeft_each = current_xhs_note_thumbnail_scrollWidth / current_xhs_note_thumbnail_num;
      current_xhs_note_thumbnail_num_current_next = current_xhs_note_thumbnail_num_current + 1;
      if (current_xhs_note_thumbnail_num_current_next >= current_xhs_note_thumbnail_num) {
        current_xhs_note_thumbnail_num_current_next = 0;
      }
      current_xhs_note_thumbnail_scrollLeft_now = current_xhs_note_thumbnail_scrollLeft_each * current_xhs_note_thumbnail_num_current_next;
      $(current_xhs_note_thumbnail).find(".xhs_note_thumbnail_imgs_cover").css({
        "width": current_xhs_note_thumbnail_scrollWidth
      });
      return $(current_xhs_note_thumbnail).animate({
        "scrollLeft": current_xhs_note_thumbnail_scrollLeft_now
      }, 500, function() {
        return $(current_xhs_note_thumbnail).attr("data-thumbnail-num-current", current_xhs_note_thumbnail_num_current_next);
      });
    });
  });

}).call(this);
